function [Y,Xf,Af] = ahu2_dampers(X,~,~)
% 50 nodes, Levenberg-Marquardt, Neural Fitting, 65 % train, 20 %
% validation, 15 % test
% X = [vav3, vav4, Tz3act-Tz3sp, Tz4act-Tz4sp];  
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 21-Jul-2023 11:34:48.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx4 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx2 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0;0;-11.8596;-7.5267];
x1_step1.gain = [0.00234814529689098;0.00189021231053693;0.130248187922086;0.183700274631911];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.7554088457754906116;4.266994201860456748;-1.4643857975693803652;-2.5217841115892278836;-1.5882650114443463973;-4.3712061246985207674;-2.6407057528601667329;7.9005077883681247286;-1.6185517809333169748;-6.2523228293441244219;-1.3402901101945923212;-8.9128173195887026026;-2.3966249219435291629;-2.1929678801367393781;-1.4230291572262041555;-0.22776210516257897054;0.34532578190538021357;0.38605368514988075423;14.421888624165472237;-0.78915702083267891265;2.455566171449489854;2.5902835543055666712;-5.597460294751752663;1.9138991541385386164;0.81595769107450843993;0.15724827027021456849;-5.2461283381708527784;-4.5536883570774975283;-12.133989344648078657;4.0458327345522793195;-0.47696340556498040275;1.6931823020457741347;3.2201397768944892697;1.1399301210232350989;5.6278832021721720835;0.31632613669734843675;2.0108812507613182952;-1.064374420541797317;-3.8452929553007022534;1.9296721976857034164;9.0472394017707493674;4.3163881981492275841;2.2657580078792980416;1.4605941961350692448;2.8812682800670463834;2.2317120336005573655;2.4040591707572436242;3.3649361263003170208;10.595959441656406241;-2.3004865648508823206];
IW1_1 = [2.1234537526296288767 1.1746753299981202989 -0.14723453647155027024 1.5620480851169176173;-2.8331662082829232041 0.58273945818842409761 0.96341211281002825384 1.4250669549664152225;-1.0754394484933285092 -1.7301572819593962205 -9.0812795217144941518 4.2439130525374197944;0.45533942868584520447 -0.75471639967175474517 -0.42855228810554624186 -3.3049385294482549469;1.2510310307566780974 0.45732842093587783294 0.78432669581201652775 1.015086220359099789;7.3768972009420235025 -2.2995735547228330908 1.5292457494454796407 7.4413748919378530644;1.108769274824864981 0.31265386399627226321 0.33939467153004487798 2.7680413276306423676;-4.9185002913629984889 5.3140271208243001766 -10.132574632510397805 -4.0923197072026065158;0.66573485668381759961 -0.37398969630695200195 -1.4863192299007639274 -4.1687476049549783141;1.4944994637883401989 7.7559793928756226578 1.4004239083088354523 -1.5335323985738413821;2.0970787116889662016 1.1071742730457203585 0.99150289951498171703 0.17569345054942547835;5.4749873652613025854 3.1102535703727922645 9.463916319169621616 9.8998710266108354006;2.6242951996992247565 -2.4022878893766224095 5.9796758459177299372 -5.9087774683052556313;3.0206393687641783785 -2.6561966456343668597 5.8465242544151667659 -5.7442559078702464248;-1.4488858081352733453 3.4683499426115309561 -5.9493750662152722342 3.2354466070574128267;-0.50128326973998482696 -0.057721300447372947406 -2.9697012254658843311 -2.77460117032004705;-1.9853402682370089316 1.7746361967866894904 -0.93424192879966738712 5.8304444902804544171;0.11312099182603063685 -2.4086393679024578063 -1.5143016313816517471 -3.8952137283129206757;2.5685812717543243799 -13.018874710618272061 0.15636196261987564404 -25.926753928171734742;-4.0407455136674572671 -7.6864356170106331589 -0.66917390974455304153 3.4316590103145387936;-2.0337865076097929595 2.9801905212112509425 -2.3387851294582846506 -3.9361958220972494971;-2.2853626982290080605 2.7648307604549509087 -3.0611678565066902102 -3.664399323113436413;1.3511483983841596768 1.0726002572850310557 4.3282121698289950373 15.336296555334465452;-0.037057650799283178844 -4.7329241378443196453 -8.0413722047292548467 -2.1692911647240507023;-2.8892081446747148732 1.6652921664604207752 -8.2694527345289365883 2.0813736824827748784;-4.0626904454335157624 -5.9484659832999415841 -3.5873272871200239109 5.29608360143593071;0.51835447381752131069 -0.9581430894762895667 -9.7911418947900035192 22.122431426287739953;3.631714758063338877 -3.9536824592261576861 13.209653609226153392 6.2324493308819821635;-2.0202099166102853722 5.210431296517850086 -0.57589119170219338351 25.334044169243622235;-3.5334826292750269872 3.6552110823439498688 -12.12390340866325289 -5.4942964767572792795;-0.050823539723107720445 2.2608112734291405665 2.129394760599797376 4.4281800664678003798;-0.29535123248006323049 -1.2969365587335826007 10.538430407266682565 -6.8807474753130497547;3.6636187452009258969 -2.3429299971152790505 11.200107452394410856 -15.654282585469502465;2.9743523844837800318 -1.3556046423742678098 1.9568388472317237436 -0.41460913565710610929;4.334848802633713305 1.4501613917598634718 -3.3543838319679881721 -8.5403822411287020344;-0.94112597137176345896 1.0720393186273191599 0.81791692954006911531 5.1140390410981728664;1.4554506327608789373 -4.7725405839783592299 4.7322954832361343591 -6.2374970633164803502;-0.40256543731996646818 1.1953904090996148035 -0.060308992005158039429 -3.1214961420809039794;0.30572730388329583118 3.8861737792732395924 7.3146408332484309511 -6.7744868650037401991;2.0548719316750045927 -0.86316522022518715751 -1.6064086274773066165 0.64825340065984637938;-1.7602392822499735026 1.8559504086194171801 -4.7088385143122124532 -16.590543555011137755;-0.50683455047578918062 -5.1991594395253599714 -4.6542370297214707975 4.0708024417436412534;0.60241898040491170807 -1.5536270365030007135 -6.5727983031566923344 3.0005363022933191353;1.3674420870852197485 -3.6028435199974886416 4.9075457238580924013 -2.3017149282419548939;-2.5156888295797470434 -4.6862689440501084093 4.1087745740904804137 -0.22613358934653596255;1.852323705716955482 -2.3790943965403998916 1.3827387268340942672 0.32610032044991393851;1.6957894377842939182 1.8446266250518887908 7.4845181812441685665 3.4124005645232795558;2.7441321383388115329 -1.2301262850668703841 1.4465623986449978045 4.1082665480958970861;9.666120260691579702 5.8989569564830084403 1.605783803589714509 0.99601058759534533138;-1.9773969487784581744 -0.21336765574439056636 -2.8569251838493894269 1.1434321032945653496];

% Layer 2
b2 = [-0.21382390458372277364;0.14005079097482497907];
LW2_1 = [0.58171674849083931935 -0.1745288542695150602 -0.020401645712776951547 -0.17339445904479866556 2.9741598478678010764 0.13643548598626151214 -1.6903475610974225685 -0.28357098110086359499 3.4433594514094831851 0.35180386392336504553 -1.4719347769132953285 0.038473008024268895433 3.2448236283022322546 -3.3183178262275752068 0.26358609080475847719 1.8216740918915887981 -2.4103079258112716232 0.93620827206449053204 0.029955897677538385199 -0.001091562647033239835 -0.77615988641312527729 0.78330524915733801272 0.12475089181530996107 -0.02625303875705089704 -0.076209859199083920811 0.042234238943639167141 -0.040743176911820673525 0.26651138845700228508 0.067407145007434429718 0.35041731640288592553 1.0377124372439154865 0.070648634844072480399 -0.037916842555198962406 -0.095011474414899391161 0.046033475816411671688 3.7340990331960428605 0.081408683181323965306 0.18580551829649361029 0.34264312523487572282 0.27740319159810722383 -0.03188849079712986756 0.35696533138228575543 -0.083194624865578784001 0.26021785304703531905 0.60744090605691847262 -0.077378724555273475927 0.48151697682410177226 3.7186696114337722818 -0.12303534622020682876 -0.060142560445642923028;3.5626031749349094113 0.17853550867887083009 -0.23890299016596561188 1.3142418535044648742 1.6412753764659280264 0.24221068080292368352 -1.6993131242396555258 0.17786137570181861922 3.8957333268814440252 0.55428465586418751432 -3.5287299458477550118 0.21657764787049452182 0.82246906600973679335 -0.99417370344651290193 3.2102630785971322247 3.1937938189204233552 -1.2673749946215167039 2.3863223067584842241 0.17554530533073442466 -0.15883794644858753586 -2.7099575756856779662 3.138015031508275321 0.29783573637049798322 -0.15693517077464186338 -0.73669900827068202087 0.25086417014716244633 -0.19351613069395073863 1.7152230966056145611 0.39084223328780637319 2.1405710175487930869 2.6231782912251788709 0.45544494036371735435 -0.30618823358724711614 -0.99814799419903887934 0.15749099660525595068 3.2312465752711458933 0.41554875450174733054 -1.5758512091860061854 2.5667671602933697095 1.946188791600158341 -0.38902191957473264416 1.9362331226160447439 -0.75316605996017804703 3.3972175026917859064 -0.10712934468019681689 -1.5730740359172961096 0.80596445025328511402 3.9078430404490807071 -0.49287829666644633608 -1.2076330286458867302];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.2;0.2];
y1_step1.xoffset = [0;0];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
